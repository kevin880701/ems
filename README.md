# 📱 iHouse EMS

## 🚀 簡介
**EMS** 是一款基於 Flutter 開發的能源管理系統（Energy Management System，EMS），支援 Android 和 iOS，幫助用戶監控與管理能源消耗。

### 主要功能：
- **設備監控**：即時監測能源設備的狀態與數據
- **數據視覺化**：提供豐富的圖表顯示用電情況
- **警報通知**：當設備異常時，自動發送提醒
- **遠端控制**：允許用戶透過應用遠端控制設備

---

## 📦 環境需求
- **Flutter SDK**：3.29.0
- **Dart SDK**：3.7.0
- **Android SDK**：34.0.0
- **Java JDK**：11.0.23

---

## 🛠️ 主要技術
- **狀態管理**：Provider (ChangeNotifier)
- **UI 框架**：Material Design
- **API 通訊**：Dio
- **本地儲存**：SharedPreferences
- **圖表視覺化**：fl_chart / syncfusion_flutter_charts

---

# 📡 API 資料整理

### 主要資訊
| 欄位名稱 | API key | 備註 | 
| --- | --- | --- | 
| 指定模式已執行時間 | Req_And_Info_3044 | 請平台搭配此值計算開始到目前的時間差 | 
| 指定模式累積供電 | L1_3144 | 請平台搭配此值計算開始到目前的累積供電量 | 
| 圖表標題&副標題 | - | - | 
| 電池電量 | hb_3066 | 單位：% | 
| 市電、綠電、儲能櫃電量 | - | - | 
| 上此使用模式的時間 | Req_And_Info_3044 | 計算特定模式切換後的使用時間 | 
| 上此使用模式的累計供電 | L1_3144 | 計算開始到目前的供電量 | 
| 電池優先模式的剩餘電量（％） | hb_3066 | 單位：% | 
| 電池優先模式的剩餘電量（度） | hb_3445、hb_3455、hb_3489、hb_3499、hb_3533、hb_3543、hb_3577、hb_3587 | 根據電池包數量相加取得整體續航力（單位:度）<br>公式：`(hb_3445 * hb_3455) / 1000` | 

### 模式資訊
| **查詢資料** | 點位名稱 | 備註 | 
| --- | --- | --- | 
| 當前模式 | Req_And_Info_3044 | 0：自發自用; 1：削峰填谷; 2：電池優先 | 
| **自發自用模式** | - | - | 
| 充電開始時間 | Req_And_Info_3317 | - | 
| 充電結束時間 | Req_And_Info_3318 | - | 
| **削峰填谷模式** | - | - | 
| 充電開始結束+放電開始結束時間 | Req_And_Info_3160 | 格式：`HHMMHHMM` | 
| 第二組充電開始結束+放電開始結束時間 | Req_And_Info_3168 | 設為 `00000000` 代表未使用 | 
| **電池優先模式** | - | - | 

---

## 📤 發送資料

### 🔌 自發自用模式
| 欄位名稱 | BODY 的 key | 備註 | 
| --- | --- | --- | 
| 設定操作模式 | M31 | - | 
| 是否啟用 | M32 | 1 為啟用; 0 為停用 | 
| 充電開始時間 | M33 | 24 小時制 | 
| 充電結束時間 | M34 | 24 小時制 | 
| 設定充電到多少 | M35 | 範圍：0 ~ 100% | 

### ⚡ 削峰填谷模式
| 欄位名稱 | BODY 的 key | 備註 | 
| --- | --- | --- | 
| 第一組時間設定操作模式 | M11 | - | 
| 第一組時間 | M12 | 格式：`HHMMHHMM`<br>充電開始~結束，放電開始~結束 | 
| 第二組時間設定操作模式 | M21 | 設定為 `00000000` 代表未使用 | 
| 第二組時間 | M22 | 格式：`HHMMHHMM`<br>充電開始~結束，放電開始~結束 | 

### 🔋 電池優先模式
| 欄位名稱 | BODY 的 key | 備註 | 
| --- | --- | --- | 
| 設定操作模式 | S8 | - | 

---